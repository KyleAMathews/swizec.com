export const title = "Module 4"

export const description = ""

export const image = "/chapter_headers/serverless-elements.png"
import { Vimeo } from "../components/Video"

# Going to production

You've built a cool app, time to put it in production! We'll make it available to the world and ensure you don't spoil production data next time you try something.

## Prod vs. Dev on backend

<Vimeo id="400644102" />

### use dev and prod configs

<Vimeo id="400644477" />

We use this helpful bash script to run `yarn deploy` and `yarn deploy prod` in the future.

```bash
STAGE=${1:-dev}
yarn build
NODE_ENV=$STAGE sls deploy --stage $STAGE
```

### see separate deploy

<Vimeo id="400644589" />

## Prod on frontend

The tricky part here is telling the webapp how to connect to different versions of the backend. I'll show you 3 approaches with the final one that worked for me.

Gatsby encourages `.env` files, which only work when you compile locally.

Zeit encourages "zeit secrets", which only work during build time.

We end up with JSON config files that always work, but aren't the most secure since you check them into your code.

<Vimeo id="400644732" />

## With Gatsby .env approach

### connect prod/dev build-time graphql

<Vimeo id="400645008" />

### runtime .env configs

<Vimeo id="400645353" />

## setup zeit manual deploys

<Vimeo id="400648337" />

## Using Zeit secrets

<Vimeo id="400646018" />

## alias to prod domain

<Vimeo id="400646330" />

## move runtime config to static queries

<Vimeo id="400646651" />

### use json files to feed configs

<Vimeo id="400647044" />

## it works in prod, yay

<Vimeo id="400647286" />
